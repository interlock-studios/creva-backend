# Container Structure Tests
# These tests validate the Docker container structure

schemaVersion: 2.0.0

# File existence tests
fileExistenceTests:
  - name: 'App files exist'
    path: '/app/main.py'
    shouldExist: true
  - name: 'Requirements installed'
    path: '/opt/venv/lib/python3.11/site-packages/fastapi'
    shouldExist: true
  - name: 'No .env file in container'
    path: '/app/.env'
    shouldExist: false
  - name: 'ffmpeg installed'
    path: '/usr/bin/ffmpeg'
    shouldExist: true

# File content tests
fileContentTests:
  - name: 'Python version'
    path: '/usr/local/bin/python'
    expectedContents: ['3.11']

# Command tests
commandTests:
  - name: 'Python works'
    command: 'python'
    args: ['--version']
    expectedOutput: ['Python 3.11']
  
  - name: 'FastAPI imported successfully'
    command: 'python'
    args: ['-c', 'import fastapi; print("OK")']
    expectedOutput: ['OK']
  
  - name: 'App runs as non-root'
    command: 'whoami'
    expectedOutput: ['appuser']
  
  - name: 'ffmpeg available'
    command: 'ffmpeg'
    args: ['-version']
    expectedOutput: ['ffmpeg version']

# Metadata tests
metadataTest:
  exposedPorts: ['8080']
  workdir: '/app'
  user: 'appuser'