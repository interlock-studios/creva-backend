---
description: Critical infrastructure rules for Creva backend
---

# Creva Backend Infrastructure

## Project Configuration

### GCP Project: `creva-e6435`

All Creva services run on the dedicated `creva-e6435` Google Cloud project.

### Services

| Service | URL | Purpose |
|---------|-----|---------|
| `creva-parser` | `https://creva-parser-{hash}.run.app` | Main API service |
| `creva-parser-worker` | `https://creva-parser-worker-{hash}.run.app` | Background video processing |

### Service Account

```
creva-parser@creva-e6435.iam.gserviceaccount.com
```

**Required Permissions:**
- `roles/aiplatform.user` - Vertex AI / Gemini access
- `roles/datastore.user` - Firestore read/write
- `roles/storage.objectAdmin` - Cloud Storage access
- `roles/secretmanager.secretAccessor` - Secret Manager access

### Firebase/Firestore

- **Project**: `creva-e6435`
- **Storage Bucket**: `creva-e6435.appspot.com`
- **Collections**:
  - `parser_cache` - Long-term video cache (365+ days)
  - `processing_queue` - Job queue for workers
  - `processing_results` - Completed job results

## Deployment

### Deploy Commands

```bash
# Full deployment (API + Worker)
make deploy

# Single region preview
make deploy-preview

# Deploy to specific region
make deploy-single-region
```

### Verify Deployment

```bash
# List Creva services
gcloud run services list --project=creva-e6435

# Check service health
curl https://creva-parser-{hash}.run.app/health
```

## Environment Variables

### Required

```bash
GOOGLE_CLOUD_PROJECT_ID=creva-e6435
SCRAPECREATORS_API_KEY=<from-secret-manager>
```

### Optional

```bash
ENVIRONMENT=production
PORT=8080
WORKER_PORT=8081
LOG_LEVEL=INFO
```

## Cache Strategy

### Long-Term Caching (365+ Days)

Video content is immutable - transcripts and hooks don't change.

**Benefits:**
- Instant results for repeat videos
- Massive cost savings
- Reduced API load

**Cache Key:** SHA256 hash of normalized URL

**Example:**
- Joe saves video on December 10th → Full processing
- Stacy saves same video on April 15th → Instant cached result

## Quick Reference

**Deployment:**
```bash
make deploy                    # Full deployment
make deploy-preview           # Single region preview
```

**Monitoring:**
```bash
make logs                     # View logs
make test-endpoints          # Test all endpoints
```
